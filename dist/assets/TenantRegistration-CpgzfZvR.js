import{j as e,f as B,r as h,u as H,n as U}from"./index-H6XvjGiV.js";import{d as D}from"./dayjs.min-rE223ni6.js";const O=1*1024*1024,M=[{key:"PHOTO",label:"Photo"},{key:"AADHAAR",label:"Aadhaar Card"},{key:"PAN",label:"PAN Card"},{key:"ID",label:"ID Card"}];async function J(c){return new Promise((d,g)=>{const o=new Image,l=new FileReader;l.onload=s=>{o.src=s.target.result},o.onload=()=>{const s=document.createElement("canvas"),i=s.getContext("2d"),b=Math.min(800/o.width,800/o.height,1);s.width=o.width*b,s.height=o.height*b,i.drawImage(o,0,0,s.width,s.height),s.toBlob(x=>{x||g(),d(new File([x],c.name,{type:"image/jpeg"}))},"image/jpeg",.7)},l.readAsDataURL(c)})}function Y({documents:c,setDocuments:d}){const g=async(l,s)=>{if(s){if(s.size<=O){d(i=>({...i,[l]:s}));return}if(s.type.startsWith("image/")){try{const i=await J(s);if(i.size>O){alert("Image is still larger than 1MB after compression");return}d(b=>({...b,[l]:i}))}catch{alert("Failed to compress image")}return}alert("File must be less than 1MB")}},o=l=>{if(!l)return null;const s=l.type.startsWith("image/"),i=URL.createObjectURL(l);return s?e.jsx("img",{src:i,alt:"preview",className:"w-16 h-16 object-cover rounded border cursor-pointer",onClick:()=>window.open(i)}):e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 cursor-pointer",onClick:()=>window.open(i),children:["ğŸ“„",e.jsx("span",{className:"text-xs underline",children:l.name})]})};return e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"ğŸ“ Upload Documents"}),M.map(l=>e.jsxs("div",{className:"flex items-center gap-4 border rounded-lg p-3",children:[e.jsx("label",{className:"w-32 text-sm font-medium",children:l.label}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:s=>g(l.key,s.target.files[0]),className:"block text-sm"}),c?.[l.key]&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[o(c[l.key]),e.jsxs("span",{className:"text-xs text-green-600",children:[(c[l.key].size/1024).toFixed(1)," KB"]}),e.jsx("button",{type:"button",onClick:()=>d(s=>({...s,[l.key]:null})),className:"text-xs text-red-500 hover:text-red-700 underline",children:"Remove"})]})]},l.key))]})}const z=["10th","12th","Diploma","Graduate","Post Graduate","PhD","Other"];function q(){const{pgId:c}=B(),[d,g]=h.useState(1),[o,l]=h.useState(!1),[s,i]=h.useState(!1),b=H(),[x,N]=h.useState(!1),[y,w]=h.useState(""),[C,f]=h.useState([]),[p,P]=h.useState({PHOTO:null,AADHAAR:null,PAN:null,ID:null}),S=D().format("YYYY-MM-DD"),I={username:"",password:"",name:"",email:"",mobileNumber:"",aadhaarNumber:"",panNumber:"",sonOf:"",age:"",qualification:"",vehicleNumber:"",parentNumber:"",workCompany:"",dob:"",dateOfJoining:S,addressDto:{address:"",areaLocality:"",city:"",district:"",state:"",pinCode:"",country:"",landmark:""}},[t,L]=h.useState(I);function n(a,m){L(v=>{const j=structuredClone(v);let u=j;const k=a.split(".");return k.slice(0,-1).forEach(T=>u=u[T]),u[k.at(-1)]=m,j})}h.useEffect(()=>{if(s){const a=setTimeout(()=>{b("/signin")},5e3);return()=>clearTimeout(a)}},[s]);function F(a){if(n("dob",a),a){const m=D().diff(D(a),"year");n("age",m)}}async function E(a){try{N(!0),w(""),f([]);const v=await(await fetch(`https://api.postalpincode.in/pincode/${a}`)).json();if(!v[0]||v[0].Status!=="Success")throw new Error;const j=v[0].PostOffice||[],u=j[0];n("addressDto.city",u.Block||u.Name||u.District),n("addressDto.district",u.District),n("addressDto.state",u.State),n("addressDto.country",u.Country),j.length>1?f(j):n("addressDto.areaLocality",u.Name)}catch{w("Invalid pincode")}finally{N(!1)}}async function R(){if(!p.PHOTO||!p.AADHAAR||!p.PAN||!p.ID){alert("Please upload all documents");return}l(!0);try{const a={...t,pgId:c,dateOfJoining:new Date(t.dateOfJoining).toISOString()};delete a.dob;const m=new FormData;m.append("request",new Blob([JSON.stringify(a)],{type:"application/json"})),m.append("photo",p.PHOTO),m.append("aadhaar",p.AADHAAR),m.append("pan",p.PAN),m.append("idCard",p.ID),await U(m),i(!0)}finally{l(!1)}}return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"rounded-2xl border bg-white p-6 shadow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-2 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Tenant Registration"}),e.jsx("div",{className:"text-sm text-gray-500",children:d===1?"Basic Details":"Documents & Address"})]}),d===1&&e.jsxs(A,{title:"Basic Details",children:[e.jsx(r,{label:"Username",value:t.username,onChange:a=>n("username",a)}),e.jsx("div",{className:"relative",children:e.jsx(r,{label:"Password",type:"password",value:t.password,onChange:a=>n("password",a)})}),e.jsx(r,{label:"Full Name",value:t.name,onChange:a=>n("name",a)}),e.jsx(r,{label:"Email",value:t.email,onChange:a=>n("email",a)}),e.jsx(r,{label:"Mobile",numeric:!0,maxLength:10,value:t.mobileNumber,onChange:a=>n("mobileNumber",a)}),e.jsx(r,{label:"Aadhaar",numeric:!0,maxLength:12,value:t.aadhaarNumber,onChange:a=>n("aadhaarNumber",a)}),e.jsx(r,{label:"PAN",value:t.panNumber,onChange:a=>n("panNumber",a)}),e.jsx(r,{label:"Son Of",value:t.sonOf,onChange:a=>n("sonOf",a)}),e.jsx(r,{label:"Date of Birth",type:"date",value:t.dob,onChange:F}),e.jsx(r,{label:"Age",value:t.age,disabled:!0}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:"Qualification"}),e.jsxs("select",{value:t.qualification,onChange:a=>n("qualification",a.target.value),className:"mt-1 w-full rounded-xl border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select"}),z.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsx(r,{label:"Vehicle Number",value:t.vehicleNumber,onChange:a=>n("vehicleNumber",a)}),e.jsx(r,{label:"Parent Mobile",numeric:!0,maxLength:10,value:t.parentNumber,onChange:a=>n("parentNumber",a)}),e.jsx(r,{label:"Work Company",value:t.workCompany,onChange:a=>n("workCompany",a)}),e.jsx(r,{label:"Date Of Joining",type:"date",min:S,value:t.dateOfJoining,onChange:a=>n("dateOfJoining",a)}),e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:e.jsx("button",{onClick:()=>g(2),className:"px-6 py-2 rounded-xl bg-indigo-600 text-white",children:"Next â†’"})})]}),d===2&&e.jsxs("div",{className:"space-y-8",children:[e.jsx(A,{title:"Upload Documents",children:e.jsx("div",{className:"sm:col-span-2",children:e.jsx(Y,{documents:p,setDocuments:P})})}),e.jsxs(A,{title:"Address Details",children:[e.jsx(r,{label:"Address",value:t.addressDto.address,onChange:a=>n("addressDto.address",a)}),e.jsx(r,{label:"Landmark",value:t.addressDto.landmark,onChange:a=>n("addressDto.landmark",a)}),e.jsx(r,{label:"Pincode",numeric:!0,maxLength:6,value:t.addressDto.pinCode,onChange:a=>{n("addressDto.pinCode",a),a.length===6&&E(a)}}),x&&e.jsx("div",{className:"text-xs",children:"Fetching addressâ€¦"}),y&&e.jsx("div",{className:"text-xs text-red-600",children:y}),C.length>1&&e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:"Area / Locality"}),e.jsxs("select",{value:t.addressDto.areaLocality,onChange:a=>n("addressDto.areaLocality",a.target.value),className:"mt-1 w-full rounded-xl border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select"}),C.map(a=>e.jsx("option",{value:a.Name,children:a.Name},a.Name))]})]}),e.jsx(r,{label:"City",value:t.addressDto.city,disabled:!0}),e.jsx(r,{label:"District",value:t.addressDto.district,disabled:!0}),e.jsx(r,{label:"State",value:t.addressDto.state,disabled:!0}),e.jsx(r,{label:"Country",value:t.addressDto.country,disabled:!0}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-2 mt-4",children:[e.jsx("button",{onClick:()=>g(1),className:"px-6 py-2 rounded-xl border",children:"â† Back"}),e.jsx("button",{disabled:o,onClick:R,className:"px-6 py-2 rounded-xl bg-green-600 text-white",children:o?"Submittingâ€¦":"Submit"})]})]})]})]}),s&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40"}),e.jsxs("div",{className:"relative bg-white rounded-2xl p-6 text-center shadow-xl w-[90%] max-w-sm",children:[e.jsx("h3",{className:"text-xl font-bold text-green-600",children:"ğŸ‰ Congratulations"}),e.jsx("p",{className:"mt-2",children:"You have been registered successfully!"}),e.jsx("button",{disabled:!0,className:"mt-4 px-6 py-2 rounded-xl bg-gray-400 text-white",children:"Redirecting... to Sign-in."})]})]})]})}function A({title:c,children:d}){return e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsx("h3",{className:"sm:col-span-2 text-lg font-semibold",children:c}),d]})}function r({label:c,value:d,onChange:g,disabled:o,numeric:l,maxLength:s,type:i="text",min:b}){const[x,N]=h.useState(!1),y=i==="password";function w(C){let f=C.target.value;l&&(f=f.replace(/\D/g,"")),s&&(f=f.slice(0,s)),g?.(f)}return e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:c}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{type:y&&x?"text":i,min:b,value:d,disabled:o,onChange:w,onBlur:()=>N(!1),className:"w-full rounded-xl border px-3 py-2 pr-10 disabled:bg-gray-100"}),y&&e.jsx("button",{type:"button","aria-label":x?"Hide password":"Show password",title:x?"Hide password":"Show password",onClick:()=>N(!x),className:"absolute inset-y-0 right-3 flex items-center text-gray-500 hover:text-indigo-600",children:x?"ğŸ™ˆ":"ğŸ‘ï¸"})]})]})}export{q as default};
