import{r as t,j as e,L as re,h as le,i as ne}from"./index-H6XvjGiV.js";import{P as ie}from"./PageHeader-BEIWCjxH.js";const Y=({className:l="h-4 w-4"})=>e.jsx("svg",{viewBox:"0 0 24 24",className:l,fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6Z"})}),de=({className:l="h-4 w-4"})=>e.jsx("svg",{viewBox:"0 0 24 24",className:l,fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7Zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"})}),oe=({className:l="h-4 w-4"})=>e.jsx("svg",{viewBox:"0 0 24 24",className:l,fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M9 6l6 6-6 6"})});function xe(){const[l,B]=t.useState([]),[h,F]=t.useState(!0),[A,_]=t.useState(""),[o,p]=t.useState(null),J=l.find(s=>s.id===o),[K,i]=t.useState(!1),[D,L]=t.useState(""),[c,G]=t.useState(""),[f,M]=t.useState(""),[q,I]=t.useState(""),[b,m]=t.useState(""),[E,j]=t.useState(""),[u,N]=t.useState([]),[O,x]=t.useState(""),[R,y]=t.useState(""),[T,v]=t.useState(""),[w,Q]=t.useState(""),[g,Z]=t.useState(!1),[U,H]=t.useState(!1),[C,S]=t.useState(""),[$,z]=t.useState(""),[V,W]=t.useState("");t.useEffect(()=>{(async()=>{try{F(!0);const a=await le();_(""),B(Array.isArray(a)?a:[])}catch{}finally{F(!1)}})()},[]);const ee=s=>s?new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"",se=async s=>{if(s.preventDefault(),!!c.trim()){Z(!0);try{const a={businessName:D.trim(),pgName:c.trim(),totalFloors:$.trim(),totalBeds:V.trim(),address:{address:f.trim(),areaLocality:b,city:O,state:R,district:E,pinCode:w,country:T,landmark:q}},n=await ne(a);B(r=>[...r,n]),L(""),G(""),z(""),W(""),M(""),I(""),x(""),y(""),Q(""),m(""),j(""),v(""),N([]),i(!1)}catch(a){console.error(a),alert("Failed to create PG")}finally{Z(!1)}}},te=async s=>{if(s.length===6){H(!0),S(""),N([]),m(""),x(""),j(""),y(""),v("");try{const n=await(await fetch(`https://api.postalpincode.in/pincode/${s}`)).json();if(n[0]?.Status==="Success"&&n[0].PostOffice?.length){const r=n[0].PostOffice;if(N(r),j(r[0].District||""),y(r[0].State||""),v("India"),r.length===1){const d=r[0];m(d.Name||""),x(d.Block||d.District||"")}}else S("Invalid pincode")}catch{S("Failed to fetch pincode details")}finally{H(!1)}}},ae=s=>{const a=u.find(n=>n.Name===s);a&&(m(a.Name),x(a.Block||a.District||""))},k=t.useMemo(()=>Array.isArray(l)?l:[],[l]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{title:"My PGs",children:e.jsx("div",{className:"flex items-center justify-end w-full sm:w-auto",children:e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-indigo-600 text-white font-medium hover:bg-indigo-700 shadow",children:[e.jsx(Y,{}),"Create new PG"]})})}),A&&e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 text-red-800 px-4 py-2 text-sm",children:A}),h&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...Array(6)].map((s,a)=>e.jsxs("div",{className:"rounded-2xl border p-4 animate-pulse bg-white",children:[e.jsx("div",{className:"h-4 w-3/4 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-3 w-1/2 bg-gray-200 rounded mb-3"}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded"})]})]},a))}),!h&&k.length===0&&e.jsxs("div",{className:"rounded-2xl border border-dashed border-indigo-300 bg-indigo-50 p-10 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-700 mb-2",children:"Welcome to PG Management ðŸŽ‰"}),e.jsx("div",{className:"text-base text-indigo-600 mb-6",children:"Create your first PG to get started"}),e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-indigo-600 text-white font-semibold hover:bg-indigo-700 shadow",children:[e.jsx(Y,{}),"Create your first PG"]})]}),!h&&k.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:k.map((s,a)=>{let n=0;for(const r of s.floors||[])for(const d of r.rooms||[])for(const P of d.beds||[])if(P.occupied&&P.tenant?.end)try{const X=Date.parse(P.tenant.end)-Date.now();X>0&&X<=168*3600*1e3&&n++}catch{}return e.jsxs(re,{to:"/pg/"+s.id,className:"group rounded-2xl border bg-white p-4 hover:shadow-md hover:-translate-y-0.5 transition",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold tracking-tight",children:s.pgName}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Created on ",ee(s.createdAt)]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-600 inline-flex items-center gap-1",children:[e.jsx(de,{}),e.jsxs("span",{className:"truncate block max-w-xs",children:[s.address?.address,", ",s.address?.areaLocality,", ",s.address?.city]})]})]}),e.jsx("div",{className:"h-8 w-8 rounded-xl bg-gradient-to-br from-indigo-100 to-blue-100 border flex items-center justify-center text-indigo-700",children:e.jsx(oe,{})})]}),e.jsxs("button",{type:"button",onClick:r=>{r.preventDefault(),p(s.id)},className:`mt-2 inline-flex items-center gap-2 px-3 py-1.5 rounded-lg\r
                              border border-indigo-200 text-indigo-700 text-xs font-medium\r
                              hover:bg-indigo-50 hover:border-indigo-300 transition`,children:[e.jsx("span",{children:"ðŸ“²"}),e.jsx("span",{children:"QR"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"rounded-lg border px-2 py-1 text-gray-700 bg-indigo-50",children:[e.jsx("div",{className:"font-semibold",children:"Floors"}),e.jsx("div",{className:"text-sm",children:s.pgFloors})]}),e.jsxs("div",{className:"rounded-lg border px-2 py-1 text-gray-700 bg-indigo-50",children:[e.jsx("div",{className:"font-semibold",children:"Beds"}),e.jsx("div",{className:"text-sm",children:s.totalBeds})]}),e.jsxs("div",{className:"rounded-lg border px-2 py-1 text-gray-700 bg-green-50",children:[e.jsx("div",{className:"font-semibold",children:"Filled"}),e.jsx("div",{className:"text-sm",children:s.filledBeds})]})]})]},s.id)})}),K&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:()=>!g&&i(!1)}),e.jsxs("div",{className:"relative w-full max-w-2xl mx-4 rounded-2xl border bg-white shadow-xl",children:[e.jsxs("div",{className:"px-6 py-4 border-b bg-gradient-to-r from-indigo-50 to-blue-50 rounded-t-2xl",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Create New PG"}),e.jsx("div",{className:"text-xs text-gray-600",children:"FIll all below details"})]}),e.jsxs("form",{onSubmit:se,className:"p-6 space-y-5",children:[e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Business Name"}),e.jsx("input",{required:!0,value:D,onChange:s=>L(s.target.value),placeholder:"e.g., Bliss Mens PG",className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"PG Name"}),e.jsx("input",{required:!0,value:c,onChange:s=>G(s.target.value),placeholder:"e.g., Bliss Mens PG",className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Total Floors"}),e.jsx("input",{type:"number",min:"0",required:!0,value:$,onChange:s=>z(s.target.value),placeholder:"e.g., 5",className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Total Beds"}),e.jsx("input",{type:"number",min:"0",required:!0,value:V,onChange:s=>W(s.target.value),placeholder:"e.g., 120",className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Address"}),e.jsx("input",{required:!0,value:f,onChange:s=>M(s.target.value),placeholder:"House/Flat, Building, Street",className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Landmark"}),e.jsx("input",{value:q,onChange:s=>I(s.target.value),placeholder:"Near XYZ Temple",className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Pincode"}),e.jsx("input",{value:w,onChange:s=>{const a=s.target.value.replace(/\D/g,"");Q(a),a.length===6&&te(a)},placeholder:"6-digit",inputMode:"numeric",maxLength:6,className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500"}),U&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Fetching addressâ€¦"}),C&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:C})]}),u.length>1&&e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Area / Locality"}),e.jsxs("select",{value:b,onChange:s=>ae(s.target.value),required:!0,className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select area"}),u.map(s=>e.jsx("option",{value:s.Name,children:s.Name},s.Name))]})]}),e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"City"}),e.jsx("input",{value:O,readOnly:!0,placeholder:"City",className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"District"}),e.jsx("input",{value:E,readOnly:!0,placeholder:"District",className:"mt-1 w-full px-3 py-2 rounded-lg border bg-gray-50"})]}),e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"State"}),e.jsx("input",{value:R,readOnly:!0,placeholder:"State",className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Country"}),e.jsx("input",{value:T,readOnly:!0,placeholder:"Country",className:"mt-1 w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",disabled:g,onClick:()=>i(!1),className:"px-4 py-2 rounded-lg border hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g||!c.trim()||!f.trim()||w.length!==6||!!C||u.length>1&&!b,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-indigo-600 text-white font-medium hover:bg-indigo-700 disabled:opacity-60",children:g?"Creatingâ€¦":"Create"})]})]})]})]}),o&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>p(null)}),e.jsxs("div",{className:"relative bg-white rounded-2xl p-6 text-center shadow-xl w-80",children:[e.jsxs("h3",{className:"text-lg font-bold mb-2",children:["Scan to Register for ",e.jsx("br",{}),e.jsx("b",{children:J?.pgName})]}),e.jsx("img",{src:`/managemypg/mmp/pg/${o}/qr`,alt:"PG QR Code",className:"mx-auto w-56 h-56"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 break-all",children:[window.location.origin,"/mmp/register/",o]}),e.jsx("button",{onClick:()=>p(null),className:"mt-4 px-4 py-2 rounded-xl bg-indigo-600 text-white",children:"Close"})]})]})]})}export{xe as default};
